!function(){!async function(){try{const t="/api/admins",o=await fetch(t),a=await o.json();e=a.admins,n=a.session,i()}catch(e){console.log(e)}}();let e=[],t=[],n=[];const o={name:/^[a-zA-ZÀ-ÿ\s]{1,40}$/,surnames:/^[a-zA-ZÀ-ÿ\s]{1,80}$/,email:/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/,password:/^.{6,10}$/,role:/^[a-z_]{1,7}$/},a={guest:"Invitado",admin:"Administrador",s_admin:"Super-Administrador"};document.querySelector("#agregar-admin").addEventListener("click",(function(){l()}));function r(n){const o=n.target.value;t=""!==o?e.filter(e=>e.role===o):[],i()}function i(){!function(){const e=document.querySelector("#listado-admins");for(;e.firstChild;)e.removeChild(e.firstChild)}(),function(){const t=e.filter(e=>"s_admin"===e.role),n=document.querySelector("#s_admin");0===t.length?n.disabled=!0:n.disabled=!1}(),function(){const t=e.filter(e=>"admin"===e.role),n=document.querySelector("#admin");0===t.length?n.disabled=!0:n.disabled=!1}(),function(){const t=e.filter(e=>"guest"===e.role),n=document.querySelector("#guest");0===t.length?n.disabled=!0:n.disabled=!1}();const o=t.length?t:e;if(0===o.length){const e=document.querySelector("#listado-admins"),t=document.createElement("THEAD"),n=document.createElement("TR");n.classList.add("table-light");const o=document.createElement("TH");return o.classList.add("fuente-roja"),o.textContent="No tienes administradores",n.appendChild(o),t.appendChild(n),void e.appendChild(t)}const r=document.createElement("THEAD"),d=document.createElement("TR"),s=document.createElement("TH");s.textContent="Nombre";const c=document.createElement("TH");c.textContent="Correo";const m=document.createElement("TH");m.textContent="Rol";const u=document.createElement("TH");d.appendChild(s),d.appendChild(c),d.appendChild(m),d.appendChild(u),r.appendChild(d);const p=document.createElement("TBODY");o.forEach(t=>{const o=document.createElement("TR");o.classList.add(t.role),""!==t.token&&o.classList.add("sin-confirmar"),o.dataset.adminId=t.id;const d=document.createElement("TD");d.classList.add("editar-admin"),d.textContent=t.name+" "+t.surnames,"s_admin"===n.role&&d.addEventListener("click",(function(){l(!0,{...t})}));const s=document.createElement("TD");s.textContent=t.email;const c=document.createElement("TD");c.textContent=a[t.role];const m=document.createElement("TD"),u=document.createElement("DIV");u.classList.add("opcion");const f=document.createElement("BUTTON");f.classList.add("btn-eliminar"),f.dataset.idAdmin=t.id,f.textContent="Eliminar","s_admin"===n.role&&(f.onclick=function(){!function(t){Swal.fire({title:"¿Eliminar admin?",showCancelButton:!0,confirmButtonText:"Sí",cancelButtonText:"No"}).then(n=>{n.isConfirmed&&async function(t){const{id:n,name:o,surnames:a,email:r,role:l,confirm:d}=t,s=new FormData;s.append("id",n),s.append("name",o),s.append("surnames",a),s.append("email",r),s.append("role",l),s.append("confirm",d);try{const n="/api/admin/delete",o=await fetch(n,{method:"POST",body:s}),a=await o.json();a.result?(Swal.fire("Eliminada",a.message,"success"),e=e.filter(e=>e.id!==t.id),i()):Swal.fire("Hubo un error",a.message,"error")}catch(e){console.log(e)}}(t)})}({...t})}),"s_admin"===n.role&&u.appendChild(f),m.appendChild(u),o.appendChild(d),o.appendChild(s),o.appendChild(c),o.appendChild(m),p.appendChild(o);const v=document.querySelector("#listado-admins");v.appendChild(r),v.appendChild(p)})}function l(t=!1,n){const a=document.createElement("DIV");a.classList.add("modals"),a.innerHTML=`\n            <form method="POST" class="formulario" novalidate>\n                <h3 class="modal-title descripcion-pagina">${t?"Editar Admin":"Agregar Admin"}</h3>\n\n                <div class="campo" id="campo-name">\n                    <label for="name">Nombre Admin</label>\n                    <input type="text" \n                        name="name" \n                        id="name"\n                        value="${t?n.name:""}"\n                        placeholder="${t?"Nuevo nombre":"Nombre Admin"}">\n                </div>\n\n                <div class="campo" id="campo-surnames">\n                    <label for="surnames">Apellidos</label>\n                    <input type="text" \n                        name="surnames" \n                        id="surnames"\n                        value="${t?n.surnames:""}"\n                        placeholder="Apellidos">\n                </div>\n\n                <div class="campo" id="campo-email">\n                    <label for="email">Correo</label>\n                    <input type="email" \n                        name="email" \n                        id="email"\n                        value="${t?n.email:""}"\n                        placeholder="${t?"Nuevo correo":"Correo"}">\n                </div>\n\n                ${t?"":'\n                    <div class="campo" id="campo-password">\n                        <label for="password">Contraseña</label>\n                        <input type="password" \n                            name="password" \n                            id="password" \n                            placeholder="Contraseña">\n                    </div>\n\n                    <div class="campo" id="campo-password2">\n                        <label for="password2">Confirmar Contraseña</label>\n                        <input type="password" \n                            name="password2" \n                            id="password2" \n                            placeholder="Confirmar Contraseña">\n                    </div>\n                '}\n\n                <div class="campo" id="campo-role">\n                    <label for="role">Seleccione un role</label>\n                    <select name="role" id="role">\n                        <option value="">-- Seleccione un role --</option>\n                        <option value="guest" ${t&&"guest"===n.role?"selected":""}>Invitado</option>\n                        <option value="admin" ${t&&"admin"===n.role?"selected":""}>Admin</option>\n                        <option value="s_admin" ${t&&"s_admin"===n.role?"selected":""}>Super Admin</option>    \n                    </select>\n                </div>\n\n                <div class="opciones">\n                    <button type="submit" class="button btn-submit">${t?"Guardar":"Crear Admin"}</button>\n                    <button type="button" class="button btn-cerrar">Cerrar</button>\n                </div>\n            </form>\n        `,setTimeout(()=>{document.querySelector(".formulario").classList.add("animarA")},0),a.addEventListener("click",(function(r){if(r.preventDefault(),r.target.classList.contains("btn-cerrar")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{a.remove()},500)}if(r.target.classList.contains("btn-submit"))if(t){const t=document.querySelector("#name").value.trim(),a=document.querySelector("#surnames").value.trim(),r=document.querySelector("#email").value.trim(),l=document.querySelector("#role").value.trim();if(""===t||""===a||""===r||""===l)return void d("Completa correctamente el formulario","error",document.querySelector(".modal-title"));if(!o.name.test(t))return void d("El nombre debe contener menos de 40 caracteres y sin números","error",document.querySelector(".modal-title"));if(!o.surnames.test(a))return void d("Los apellidos deben contener menos de 80 caracteres y sin números","error",document.querySelector(".modal-title"));if(!o.email.test(r))return void d("Coloca un correo válido","error",document.querySelector(".modal-title"));if(!o.role.test(l))return void d("Coloca un rol válido","error",document.querySelector(".modal-title"));n.name=t,n.surnames=a,n.email=r,n.role=l,async function(t){const{id:n,name:o,surnames:a,email:r,role:l,confirm:d}=t,s=new FormData;s.append("id",n),s.append("name",o),s.append("surnames",a),s.append("email",r),s.append("role",l),s.append("confirm",d);try{const t="/api/admin/update",c=await fetch(t,{method:"POST",body:s}),m=await c.json();if("exito"===m.type){Swal.fire("Actualizado",m.message,"success");const t=document.querySelector(".modals");setTimeout(()=>{t.remove()},500),e=e.map(e=>(e.id===n&&(e.name=o,e.surnames=a,e.email=r,e.role=l,e.confirm=d),e)),i()}}catch(e){console.log(e)}}(n)}else{const t=document.querySelector("#name").value.trim(),n=document.querySelector("#surnames").value.trim(),a=document.querySelector("#email").value.trim(),r=document.querySelector("#password").value.trim(),l=document.querySelector("#password2").value.trim(),s=document.querySelector("#role").value.trim();if(""===t||""===n||""===a||""===r||""===l||""===s)return void d("Completa correctamente el formulario","error",document.querySelector(".modal-title"));if(!o.name.test(t))return void d("El nombre debe contener menos de 40 caracteres y sin números","error",document.querySelector(".modal-title"));if(!o.surnames.test(n))return void d("Los apellidos deben contener menos de 80 caracteres y sin números","error",document.querySelector(".modal-title"));if(!o.email.test(a))return void d("Coloca un correo válido","error",document.querySelector(".modal-title"));if(!o.password.test(r))return void d("La contraseña debe ser mínimo de 6 caracteres y máximo de 10","error",document.querySelector(".modal-title"));if(r!==l)return void d("Las contraseñas son diferentes","error",document.querySelector(".modal-title"));if(!o.role.test(s))return void d("Coloca un rol válido","error",document.querySelector(".modal-title"));!async function(t,n,o,a,r,l){const d=new FormData;d.append("name",t),d.append("surnames",n),d.append("email",o),d.append("password",a),d.append("password2",r),d.append("role",l);try{const a="/api/admin",r=await fetch(a,{method:"POST",body:d}),s=await r.json();if("exito"===s.type){Swal.fire({icon:"success",title:s.title,text:s.message});const a=document.querySelector(".modals");setTimeout(()=>{a.remove()},500);const r={id:String(s.id),name:t,surnames:n,email:o,role:l,token:s.token,confirm:s.confirm};e=[...e,r],i()}else{Swal.fire({icon:"error",title:r.title,text:r.message});const e=document.querySelector(".modals");setTimeout(()=>{e.remove()},500)}}catch(e){console.log(e)}}(t,n,a,r,l,s)}})),document.querySelector(".dashboard").appendChild(a)}function d(e,t,n){const o=document.querySelector(".alerta");o&&o.remove();const a=document.createElement("DIV");a.classList.add("alerta",t),a.textContent=e,n.parentElement.insertBefore(a,n.nextElementSibling),setTimeout(()=>{a.remove()},5e3)}document.querySelectorAll('#filtros input[type="radio"]').forEach(e=>{e.addEventListener("input",r)})}();