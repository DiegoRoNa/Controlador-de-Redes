!function(){!async function(){try{const t="http://localhost:8000/api/ips?id="+d(),o=await fetch(t),a=await o.json();e=a.ips,n=a.session,s()}catch(e){console.log(e)}}();let e=[],t=[],n=[];const o={host:/^[a-zA-Z0-9\_\-\s]{1,20}$/,name:/^[a-zA-ZÀ-ÿ\s]{1,40}$/,surnames:/^[a-zA-ZÀ-ÿ\s]{1,80}$/,email:/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/};function a(n){const o=n.target.value;t=""!==o?e.filter(e=>e.usingg===o):[],s()}function s(){!function(){const e=document.querySelector("#listado-ips");for(;e.firstChild;)e.removeChild(e.firstChild)}(),function(){const t=e.filter(e=>"0"===e.usingg),n=document.querySelector("#sin-uso");0===t.length?n.disabled=!0:n.disabled=!1}(),function(){const t=e.filter(e=>"1"===e.usingg),n=document.querySelector("#usando");0===t.length?n.disabled=!0:n.disabled=!1}();const o=t.length?t:e,a={0:"Sin-usar",1:"Usando"},s=document.createElement("THEAD"),r=document.createElement("TR"),l=document.createElement("TH");l.textContent="Ip";const d=document.createElement("TH");d.textContent="Host";const u=document.createElement("TH");u.textContent="Usuario";const m=document.createElement("TH");m.textContent="Correo usuario";const p=document.createElement("TH");r.appendChild(l),r.appendChild(d),r.appendChild(u),r.appendChild(m),r.appendChild(p),s.appendChild(r);const h=document.createElement("TBODY");o.forEach(e=>{const t=document.createElement("TR");t.dataset.ipId=e.id;const o=document.createElement("TD");o.textContent=e.fi_octet+"."+e.s_octet+"."+e.t_octet+"."+e.fo_octet,o.classList.add("editar-ip"),"s_admin"!==n.role&&"admin"!==n.role||"1"===e.usingg&&o.addEventListener("click",(function(){i(!0,{...e})}));const r=document.createElement("TD");r.textContent=e.host;const l=document.createElement("TD");l.textContent=e.name+" "+e.surnames;const d=document.createElement("TD");d.textContent=e.email;const u=document.createElement("TD"),m=document.createElement("DIV");m.classList.add("opcion");const p=document.createElement("BUTTON");p.classList.add("btn-usingg"),p.classList.add(""+a[e.usingg].toLowerCase()),p.textContent=a[e.usingg],p.dataset.usinggIp=e.usingg,"0"===e.usingg?p.onclick=function(){i(!1,{...e})}:p.onclick=function(){!function(e){Swal.fire({title:"¿Deseas dejar de usar esta IP? "+e.fi_octet+"."+e.s_octet+"."+e.t_octet+"."+e.fo_octet,showCancelButton:!0,confirmButtonText:"Sí",cancelButtonText:"No"}).then(t=>{t.isConfirmed&&(e.host="",e.name="",e.surnames="",e.email="",c(e))})}({...e})},"s_admin"!==n.role&&"admin"!==n.role||m.appendChild(p),u.appendChild(m),t.appendChild(o),t.appendChild(r),t.appendChild(l),t.appendChild(d),t.appendChild(u),h.appendChild(t);const f=document.querySelector("#listado-ips");f.appendChild(s),f.appendChild(h)})}function i(e=!1,t){const n=document.createElement("DIV");n.classList.add("modals"),n.innerHTML=`\n            <form method="POST" class="formulario" novalidate>\n                <h3 class="modal-title descripcion-pagina">${e?"Editar host":"Asigna a un host la IP "+t.fi_octet+"."+t.s_octet+"."+t.t_octet+"."+t.fo_octet}</h3>\n\n                <div class="campo" id="campo-host">\n                    <label for="host">Nombre Equipo</label>\n                    <input type="text" \n                           name="host" \n                           id="host"\n                           value="${e?t.host:""}"\n                           placeholder="${e?"Nuevo host":"Nombre equipo"}">\n                </div>\n\n                <div class="campo" id="campo-name">\n                    <label for="name">Nombre usuario</label>\n                    <input type="text" \n                           name="name" \n                           id="name"\n                           value="${e?t.name:""}"\n                           placeholder="${e?"Nuevo usuario":"Asigna usuario"}">\n                </div>\n\n                <div class="campo" id="campo-surnames">\n                    <label for="surnames">Apellidos usuario</label>\n                    <input type="text" \n                           name="surnames" \n                           id="surnames"\n                           value="${e?t.surnames:""}"\n                           placeholder="Apellidos usuario">\n                </div>\n\n                <div class="campo" id="campo-email">\n                    <label for="email">Correo usuario</label>\n                    <input type="text" \n                           name="email" \n                           id="email"\n                           value="${e?t.email:""}"\n                           placeholder="${e?"Nuevo correo":"Correo usuario"}">\n                </div>\n\n                <div class="opciones">\n                    <button type="submit" class="button btn-submit">${e?"Guardar":"Asignar"}</button>\n                    <button type="button" class="button btn-cerrar">Cerrar</button>\n                </div>\n            </form>\n        `,setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},0),n.addEventListener("click",(function(a){if(a.preventDefault(),a.target.classList.contains("btn-cerrar")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{n.remove()},500)}if(a.target.classList.contains("btn-submit")){const n=document.querySelector("#host").value.trim(),a=document.querySelector("#name").value.trim(),s=document.querySelector("#surnames").value.trim(),i=document.querySelector("#email").value.trim();if(""===n||""===a||""===s||""===i)return void r("Completa correctamente el formulario","error",document.querySelector(".modal-title"));if(!o.host.test(n))return void r("Coloca un nombre de host más corto, puedes usar '-' ó '_'","error",document.querySelector(".modal-title"));if(!o.name.test(a))return void r("Coloca un nombre para el usuario válido","error",document.querySelector(".modal-title"));if(!o.surnames.test(s))return void r("Coloca apellidos para el usuario válidos","error",document.querySelector(".modal-title"));if(!o.email.test(i))return void r("Coloca un correo válido","error",document.querySelector(".modal-title"));e?(t.host=n,t.name=a,t.surnames=s,t.email=i,l(t)):(t.host=n,t.name=a,t.surnames=s,t.email=i,c(t))}})),document.querySelector(".dashboard").appendChild(n)}function r(e,t,n){const o=document.querySelector(".alerta");o&&o.remove();const a=document.createElement("DIV");a.classList.add("alerta",t),a.textContent=e,n.parentElement.insertBefore(a,n.nextElementSibling),setTimeout(()=>{a.remove()},5e3)}function c(e){const t="1"===e.usingg?"0":"1";e.usingg=t,l(e)}async function l(t){const{id:n,idNetwork:o,fi_octet:a,s_octet:i,t_octet:r,fo_octet:c,host:l,name:u,surnames:m,email:p,usingg:h}=t,f=new FormData;f.append("id",n),f.append("idNetwork",o),f.append("fi_octet",a),f.append("s_octet",i),f.append("t_octet",r),f.append("fo_octet",c),f.append("host",l),f.append("name",u),f.append("surnames",m),f.append("email",p),f.append("usingg",h),f.append("url",d());try{const t="http://localhost:8000/api/host",o=await fetch(t,{method:"POST",body:f}),a=await o.json();if("exito"!==a.type){Swal.fire({icon:"error",title:"Error",text:a.message});const e=document.querySelector(".modals");return void(e&&e.remove())}{Swal.fire({icon:"success",title:a.title,text:a.message});const t=document.querySelector(".modals");t&&t.remove(),e=e.map(e=>(e.id===n&&(e.host=l,e.name=u,e.surnames=m,e.email=p,e.usingg=h),e)),s()}}catch(e){console.log(e)}}function d(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).id}document.querySelectorAll('#filtros input[type="radio"]').forEach(e=>{e.addEventListener("input",a)})}();