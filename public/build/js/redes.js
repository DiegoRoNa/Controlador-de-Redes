!function(){!async function(){try{const t="http://localhost:8000/api/networks",n=await fetch(t),r=await n.json();e=r.networks,o()}catch(e){console.log(e)}}(),document.querySelector("#modalNew").addEventListener("click",(function(r){if(r.preventDefault(),r.target.classList.contains("btn-submit")){const r=document.querySelector("#network").value.trim(),c=document.querySelector("#fioctet").value.trim(),a=document.querySelector("#soctet").value.trim(),d=document.querySelector("#toctet").value.trim(),l=document.querySelector("#fooctet").value.trim();if(""===r||""===c||""===a||""===d||""===l)return void n("Completa correctamente el formulario","error",document.querySelector(".modal-header"));if(!t.network.test(r))return void n("El nombre debe contener menos de 20 caracteres y acepta '- ó _'","error",document.querySelector(".modal-header"));if(!(t.octet.test(c)&&t.octet.test(a)&&t.octet.test(d)&&t.octet.test(l)))return void n("Coloca un formato válido para la IP","error",document.querySelector(".modal-header"));!async function(t,r,c,a,d){const l=new FormData;l.append("network",t),l.append("fi_octet",r),l.append("s_octet",c),l.append("t_octet",a),l.append("fo_octet",d);try{const i="http://localhost:8000/api/network",s=await fetch(i,{method:"POST",body:l}),u=await s.json();if(n(u.message,u.type,document.querySelector(".modal-header")),"error"===u.type)return;{const e=document.querySelector(".btn-cerrar");setTimeout(()=>{e.click()},2e3)}const m={id:String(u.id),network:t,fi_octet:r,s_octet:c,t_octet:a,fo_octet:d,url:u.url};e=[...e,m],o()}catch(e){console.log(e)}}(r,c,a,d,l)}}));let e=[];const t={octet:/^([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])$/,network:/^[a-zA-Z0-9\_\-\s]{1,20}$/};function o(){!function(){const e=document.querySelector("#listado-redes");for(;e.firstChild;)e.removeChild(e.firstChild)}();const r=e;if(0===r.length){const e=document.querySelector("#listado-redes"),t=document.createElement("THEAD"),o=document.createElement("TR");o.classList.add("table-light");const n=document.createElement("TH");return n.classList.add("fuente-roja"),n.textContent="No hay redes creadas",o.appendChild(n),t.appendChild(o),void e.appendChild(t)}const c=document.createElement("THEAD"),a=document.createElement("TR"),d=document.createElement("TH");d.textContent="Red";const l=document.createElement("TH");l.textContent="IP Global";const i=document.createElement("TH");a.appendChild(d),a.appendChild(l),a.appendChild(i),c.appendChild(a);const s=document.createElement("TBODY");r.forEach(r=>{const a=document.createElement("TR");a.dataset.networkId=r.id;const d=document.createElement("TD");d.textContent=r.network,d.classList.add("editar-red"),d.dataset.bsToggle="modal",d.dataset.bsTarget="#modalEditRed",d.addEventListener("click",(function(){!function(e){const o=document.querySelector("#newNetwork");o.setAttribute("value",e.network);document.querySelector("#modalEdit").addEventListener("click",(function(r){if(r.preventDefault(),r.target.classList.contains("btn-submit")){const r=o.value.trim();if(""===r)return void n("Coloca un nombre a la red","error",document.querySelector(".modal-header"));if(!t.network.test(r))return void n("El nombre debe contener menos de 20 caracteres y acepta '- ó _'","error",document.querySelector(".modal-header"));e.network=r,async function(e){console.log(e)}(e)}}))}({...r})}));const l=document.createElement("TD");l.textContent=r.fi_octet+"."+r.s_octet+"."+r.t_octet+"."+r.fo_octet;const i=document.createElement("TD"),u=document.createElement("DIV");u.classList.add("opcion-eliminar");const m=document.createElement("A");m.setAttribute("href","/network?id="+r.url),m.classList.add("btn-entrar"),m.textContent="Entrar";const p=document.createElement("BUTTON");p.classList.add("btn-eliminar"),p.dataset.idNetwork=r.id,p.textContent="Eliminar",p.onclick=function(){!function(t){Swal.fire({title:"¿Eliminar red?",showCancelButton:!0,confirmButtonText:"Sí",cancelButtonText:"No"}).then(n=>{n.isConfirmed&&async function(t){const{id:n,fi_octet:r,s_octet:c,t_octet:a,fo_octet:d,url:l}=t,i=new FormData;i.append("id",n),i.append("network",t.network),i.append("fi_octet",r),i.append("s_octet",c),i.append("t_octet",a),i.append("fo_octet",d),i.append("url",l);try{const n="http://localhost:8000/api/network/delete",r=await fetch(n,{method:"POST",body:i}),c=await r.json();c.result?(Swal.fire("Eliminada",c.message,"success"),e=e.filter(e=>e.id!==t.id),o()):Swal.fire("Hubo un error",c.message,"error")}catch(e){Swal.fire("Hubo un error","No se pudo eliminar la red","error")}}(t)})}({...r})},u.appendChild(m),u.appendChild(p),i.appendChild(u),a.appendChild(d),a.appendChild(l),a.appendChild(i),s.appendChild(a);const f=document.querySelector("#listado-redes");f.appendChild(c),f.appendChild(s)})}function n(e,t,o){const n=document.querySelector(".alerta");n&&n.remove();const r=document.createElement("DIV");r.classList.add("alerta",t),r.textContent=e,o.parentElement.insertBefore(r,o.nextElementSibling),setTimeout(()=>{r.remove()},5e3)}}();