!function(){!async function(){try{const o="http://localhost:8000/api/networks",c=await fetch(o),r=await c.json();e=r.networks,t=r.session,n()}catch(e){console.log(e)}}();let e=[],t=[];const o={octet:/^([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])$/,fioctet:/^([1-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])$/,fooctet:/^[0]$/,network:/^[a-zA-Z0-9\_\-\s]{1,20}$/};function n(){!function(){const e=document.querySelector("#listado-redes");for(;e.firstChild;)e.removeChild(e.firstChild)}();const o=e;if(0===o.length){const e=document.querySelector(".contenedor"),t=document.createElement("DIV");t.classList.add("descripcion-pagina");const o=document.createElement("H2");return o.classList.add("fuente-roja"),o.textContent="No hay redes creadas",t.appendChild(o),void e.appendChild(t)}o.forEach(o=>{const r=document.createElement("DIV");r.classList.add("card","card-contenido","card-"+function(e){const t=e.toString().split("").map(Number);return t[t.length-1]}(o.id)),r.dataset.networkId=o.id;const a=document.createElement("H2");a.classList.add("card-header","editar-red"),a.textContent=o.network,"s_admin"!==t.role&&"admin"!==t.role||a.addEventListener("click",(function(){c(!0,{...o})}));const d=document.createElement("DIV");d.classList.add("card-body");const i=document.createElement("H3");i.classList.add("card-text"),i.textContent=o.fi_octet+"."+o.s_octet+"."+o.t_octet+"."+o.fo_octet;const s=document.createElement("DIV");s.classList.add("card-footer","opcion");const l=document.createElement("A");l.setAttribute("href","/network?id="+o.url),l.classList.add("btn-entrar"),l.textContent="Entrar";const u=document.createElement("BUTTON");u.classList.add("btn-eliminar"),u.dataset.idNetwork=o.id,u.textContent="Eliminar","s_admin"!==t.role&&"admin"!==t.role||(u.onclick=function(){!function(t){Swal.fire({title:"¿Eliminar red?",showCancelButton:!0,confirmButtonText:"Sí",cancelButtonText:"No"}).then(o=>{o.isConfirmed&&async function(t){const{id:o,fi_octet:c,s_octet:r,t_octet:a,fo_octet:d,url:i}=t,s=new FormData;s.append("id",o),s.append("network",t.network),s.append("fi_octet",c),s.append("s_octet",r),s.append("t_octet",a),s.append("fo_octet",d),s.append("url",i);try{const o="http://localhost:8000/api/network/delete",c=await fetch(o,{method:"POST",body:s}),r=await c.json();r.result?(Swal.fire("Eliminada",r.message,"success"),e=e.filter(e=>e.id!==t.id),n()):Swal.fire("Hubo un error",r.message,"error")}catch(e){Swal.fire("Hubo un error","No se pudo eliminar la red","error")}}(t)})}({...o})}),d.appendChild(i),s.appendChild(l),"s_admin"!==t.role&&"admin"!==t.role||s.appendChild(u),r.appendChild(a),r.appendChild(d),r.appendChild(s);document.querySelector("#listado-redes").appendChild(r)})}function c(t=!1,c){const a=document.createElement("DIV");a.classList.add("modals"),a.innerHTML=`\n            <form method="POST" class="formulario" novalidate>\n                <h3 class="modal-title descripcion-pagina">${t?"Editar Red":"Agregar Red"}</h3>\n\n                <div class="campo" id="campo-network">\n                    <label for="network">Nombre Red</label>\n                    <input type="text" \n                           name="network" \n                           id="network"\n                           value="${t?c.network:""}"\n                           placeholder="${t?"Nuevo nombre":"Nombre Red"}">\n                </div>\n\n                ${t?"":'\n                    <div class="campo" id="campo-octet">\n                        <label for="fioctet">IP Global</label>\n                        <div class="octets">\n                            <div class="campo" id="campo-fioctet">\n                                <input type="number" class="octet" name="fioctet" id="fioctet">\n                            </div>\n                            <div class="campo" id="campo-soctet">\n                                <input type="number" class="octet" name="soctet" id="soctet">\n                            </div>\n                            <div class="campo" id="campo-toctet">\n                                <input type="number" class="octet" name="toctet" id="toctet">\n                            </div>\n                            <div class="campo" id="campo-fooctet">\n                                <input type="number" class="octet" name="fooctet" id="fooctet">\n                            </div>\n                        </div>\n                    </div>\n                '}\n\n                <div class="opciones">\n                    <button type="submit" class="button btn-submit">${t?"Guardar":"Agregar"}</button>\n                    <button type="button" class="button btn-cerrar">Cerrar</button>\n                </div>\n            </form>\n        `,setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},0),a.addEventListener("click",(function(d){if(d.preventDefault(),d.target.classList.contains("btn-cerrar")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{a.remove()},500)}if(d.target.classList.contains("btn-submit"))if(t){const t=document.querySelector("#network").value.trim();if(""===t)return void r("Coloca un nombre a la red","error",document.querySelector(".modal-title"));if(!o.network.test(t))return void r("El nombre debe contener menos de 20 caracteres y acepta '-' ó '_'","error",document.querySelector(".modal-title"));c.network=t,async function(t){const{id:o,fi_octet:c,s_octet:r,t_octet:a,fo_octet:d,url:i}=t,s=new FormData;s.append("id",o),s.append("network",t.network),s.append("fi_octet",c),s.append("s_octet",r),s.append("t_octet",a),s.append("fo_octet",d),s.append("url",i);try{const c="http://localhost:8000/api/network/update",r=await fetch(c,{method:"POST",body:s}),a=await r.json();if("exito"===a.type){Swal.fire("Actualizado",a.message,"success");const c=document.querySelector(".modals");setTimeout(()=>{c.remove()},500),e=e.map(e=>(e.id===o&&(e.network=t.network),e)),n()}}catch(e){console.log(e)}}(c)}else{const t=document.querySelector("#network").value.trim(),c=document.querySelector("#fioctet").value.trim(),a=document.querySelector("#soctet").value.trim(),d=document.querySelector("#toctet").value.trim(),i=document.querySelector("#fooctet").value.trim();if(""===t||""===c||""===a||""===d||""===i)return void r("Completa correctamente el formulario","error",document.querySelector(".modal-title"));if(!o.network.test(t))return void r("El nombre debe contener menos de 20 caracteres y acepta '- ó _'","error",document.querySelector(".modal-title"));if(!(o.fioctet.test(c)&&o.octet.test(c)&&o.octet.test(a)&&o.octet.test(d)))return void r("Coloca un formato válido para la IP","error",document.querySelector(".modal-title"));if(!o.fooctet.test(i))return void r("El último octeto debe ser 0","error",document.querySelector(".modal-title"));!async function(t,o,c,r,a){const d=document.querySelector(".modals");setTimeout(()=>{d.remove()},0),function(){const e=document.createElement("DIV");e.classList.add("modals"),e.innerHTML='\n            <div class="wait-contenido">\n                <div class="spinner-border text-light wait" role="status">\n                    <span class="visually-hidden"></span>\n                </div>\n            </div>            \n        ',document.querySelector(".dashboard").appendChild(e)}();const i=new FormData;i.append("network",t),i.append("fi_octet",o),i.append("s_octet",c),i.append("t_octet",r),i.append("fo_octet",a);try{const d="http://localhost:8000/api/network",s=await fetch(d,{method:"POST",body:i}),l=await s.json();if("error"===l.type)return;{const e=document.querySelector(".modals");setTimeout(()=>{e.remove()},0),Swal.fire("Correcto",l.message,"success")}const u={id:String(l.id),network:t,fi_octet:o,s_octet:c,t_octet:r,fo_octet:a,url:l.url};e=[...e,u],n()}catch(e){console.log(e)}}(t,c,a,d,i)}})),document.querySelector(".dashboard").appendChild(a)}function r(e,t,o){const n=document.querySelector(".alerta");n&&n.remove();const c=document.createElement("DIV");c.classList.add("alerta",t),c.textContent=e,o.parentElement.insertBefore(c,o.nextElementSibling),setTimeout(()=>{c.remove()},5e3)}document.querySelector("#agregar-red").addEventListener("click",(function(){c()}))}();