!function(){!async function(){try{const o="http://localhost:8000/api/networks",c=await fetch(o),r=await c.json();e=r.networks,t=r.session,n()}catch(e){console.log(e)}}();let e=[],t=[];const o={octet:/^([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])$/,fioctet:/^([1-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])$/,fooctet:/^[0]$/,network:/^[a-zA-Z0-9\_\-\s]{1,20}$/};function n(){!function(){const e=document.querySelector("#listado-redes");for(;e.firstChild;)e.removeChild(e.firstChild)}();const o=e;if(0===o.length){const e=document.querySelector("#listado-redes"),t=document.createElement("THEAD"),o=document.createElement("TR");o.classList.add("table-light");const n=document.createElement("TH");return n.classList.add("fuente-roja"),n.textContent="No hay redes creadas",o.appendChild(n),t.appendChild(o),void e.appendChild(t)}const r=document.createElement("THEAD"),a=document.createElement("TR"),d=document.createElement("TH");d.textContent="Red";const i=document.createElement("TH");i.textContent="IP Global";const l=document.createElement("TH");a.appendChild(d),a.appendChild(i),a.appendChild(l),r.appendChild(a);const s=document.createElement("TBODY");o.forEach(o=>{const a=document.createElement("TR");a.dataset.networkId=o.id;const d=document.createElement("TD");d.textContent=o.network,d.classList.add("editar-red"),"s_admin"!==t.role&&"admin"!==t.role||d.addEventListener("click",(function(){c(!0,{...o})}));const i=document.createElement("TD");i.textContent=o.fi_octet+"."+o.s_octet+"."+o.t_octet+"."+o.fo_octet;const l=document.createElement("TD"),m=document.createElement("DIV");m.classList.add("opcion-eliminar");const u=document.createElement("A");u.setAttribute("href","/network?id="+o.url),u.classList.add("btn-entrar"),u.textContent="Entrar";const p=document.createElement("BUTTON");p.classList.add("btn-eliminar"),p.dataset.idNetwork=o.id,p.textContent="Eliminar",p.onclick=function(){!function(t){Swal.fire({title:"¿Eliminar red?",showCancelButton:!0,confirmButtonText:"Sí",cancelButtonText:"No"}).then(o=>{o.isConfirmed&&async function(t){const{id:o,fi_octet:c,s_octet:r,t_octet:a,fo_octet:d,url:i}=t,l=new FormData;l.append("id",o),l.append("network",t.network),l.append("fi_octet",c),l.append("s_octet",r),l.append("t_octet",a),l.append("fo_octet",d),l.append("url",i);try{const o="http://localhost:8000/api/network/delete",c=await fetch(o,{method:"POST",body:l}),r=await c.json();r.result?(Swal.fire("Eliminada",r.message,"success"),e=e.filter(e=>e.id!==t.id),n()):Swal.fire("Hubo un error",r.message,"error")}catch(e){Swal.fire("Hubo un error","No se pudo eliminar la red","error")}}(t)})}({...o})},m.appendChild(u),"s_admin"!==t.role&&"admin"!==t.role||m.appendChild(p),l.appendChild(m),a.appendChild(d),a.appendChild(i),a.appendChild(l),s.appendChild(a);const f=document.querySelector("#listado-redes");f.appendChild(r),f.appendChild(s)})}function c(t=!1,c){const a=document.createElement("DIV");a.classList.add("modals"),a.innerHTML=`\n            <form method="POST" class="formulario" novalidate>\n                <h3 class="modal-title descripcion-pagina">${t?"Editar Red":"Agregar Red"}</h3>\n\n                <div class="campo" id="campo-network">\n                    <label for="network">Nombre Red</label>\n                    <input type="text" \n                           name="network" \n                           id="network"\n                           value="${t?c.network:""}"\n                           placeholder="${t?"Nuevo nombre":"Nombre Red"}">\n                </div>\n\n                ${t?"":'\n                    <div class="campo" id="campo-octet">\n                        <label for="fioctet">IP Global</label>\n                        <div class="octets">\n                            <div class="campo" id="campo-fioctet">\n                                <input type="number" class="octet" name="fioctet" id="fioctet">\n                            </div>\n                            <div class="campo" id="campo-soctet">\n                                <input type="number" class="octet" name="soctet" id="soctet">\n                            </div>\n                            <div class="campo" id="campo-toctet">\n                                <input type="number" class="octet" name="toctet" id="toctet">\n                            </div>\n                            <div class="campo" id="campo-fooctet">\n                                <input type="number" class="octet" name="fooctet" id="fooctet">\n                            </div>\n                        </div>\n                    </div>\n                '}\n\n                <div class="opciones">\n                    <button type="submit" class="button btn-submit">${t?"Guardar":"Agregar"}</button>\n                    <button type="button" class="button btn-cerrar">Cerrar</button>\n                </div>\n            </form>\n        `,setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},0),a.addEventListener("click",(function(d){if(d.preventDefault(),d.target.classList.contains("btn-cerrar")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{a.remove()},500)}if(d.target.classList.contains("btn-submit"))if(t){const t=document.querySelector("#network").value.trim();if(""===t)return void r("Coloca un nombre a la red","error",document.querySelector(".modal-title"));if(!o.network.test(t))return void r("El nombre debe contener menos de 20 caracteres y acepta '-' ó '_'","error",document.querySelector(".modal-title"));c.network=t,async function(t){const{id:o,fi_octet:c,s_octet:r,t_octet:a,fo_octet:d,url:i}=t,l=new FormData;l.append("id",o),l.append("network",t.network),l.append("fi_octet",c),l.append("s_octet",r),l.append("t_octet",a),l.append("fo_octet",d),l.append("url",i);try{const c="http://localhost:8000/api/network/update",r=await fetch(c,{method:"POST",body:l}),a=await r.json();if("exito"===a.type){Swal.fire("Actualizado",a.message,"success");const c=document.querySelector(".modals");setTimeout(()=>{c.remove()},500),e=e.map(e=>(e.id===o&&(e.network=t.network),e)),n()}}catch(e){console.log(e)}}(c)}else{const t=document.querySelector("#network").value.trim(),c=document.querySelector("#fioctet").value.trim(),a=document.querySelector("#soctet").value.trim(),d=document.querySelector("#toctet").value.trim(),i=document.querySelector("#fooctet").value.trim();if(""===t||""===c||""===a||""===d||""===i)return void r("Completa correctamente el formulario","error",document.querySelector(".modal-title"));if(!o.network.test(t))return void r("El nombre debe contener menos de 20 caracteres y acepta '- ó _'","error",document.querySelector(".modal-title"));if(!(o.fioctet.test(c)&&o.octet.test(c)&&o.octet.test(a)&&o.octet.test(d)))return void r("Coloca un formato válido para la IP","error",document.querySelector(".modal-title"));if(!o.fooctet.test(i))return void r("El último octeto debe ser 0","error",document.querySelector(".modal-title"));!async function(t,o,c,a,d){const i=new FormData;i.append("network",t),i.append("fi_octet",o),i.append("s_octet",c),i.append("t_octet",a),i.append("fo_octet",d);try{const l="http://localhost:8000/api/network",s=await fetch(l,{method:"POST",body:i}),m=await s.json();if(r(m.message,m.type,document.querySelector(".modal-title")),"error"===m.type)return;{const e=document.querySelector(".modals");setTimeout(()=>{e.remove()},2e3)}const u={id:String(m.id),network:t,fi_octet:o,s_octet:c,t_octet:a,fo_octet:d,url:m.url};e=[...e,u],n()}catch(e){console.log(e)}}(t,c,a,d,i)}})),document.querySelector(".dashboard").appendChild(a)}function r(e,t,o){const n=document.querySelector(".alerta");n&&n.remove();const c=document.createElement("DIV");c.classList.add("alerta",t),c.textContent=e,o.parentElement.insertBefore(c,o.nextElementSibling),setTimeout(()=>{c.remove()},5e3)}document.querySelector("#agregar-red").addEventListener("click",(function(){c()}))}();